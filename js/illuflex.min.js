var config={negativeBufferSpace:100,debug:false,cWidth:1000,cHeight:750};var IFScreen={isActive:true,isMobile:function(){return window.innerWidth<639},height:function(){return Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,window.innerHeight)},width:function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)}};window.onfocus=function(){IFScreen.isActive=true};window.onblur=function(){IFScreen.isActive=false};function Illuflex(c,a,b,d){if(!this.exists(a)&&config.debug){console.log("WARNING! root sources object isn't defined!")}this.callback=d||false;this.defaults={renderConfig:{wobble:false,wobbleSpeed:2000,background:false,defaultObjSettings:{em:1,bg:"#000",anim:{reEnter:false,pulse:false,move:true,rotate:false,easing:"mina.easeinout",restlessness:1,speed:7,intensity:10,tendency:{x:0,y:0,r:0},negativeBufferSpace:config.negativeBufferSpace,scaling:{min:0.95,max:1.05}}}},illuConfig:{}};this.canvas={state:0,renderConfig:this.recursiveMerge(c.renderConfig,this.defaults.renderConfig),illuConfig:(!c.illuConfig)?this.defaults.illuConfig:c.illuConfig,paper:Snap("#canvas"),elements:[]};if(config.debug){console.log("Illuflex initialised!")}if(a&&b){this.getSources(a,b)}if(this.canvas.renderConfig.background){this.drawBackground()}this.drawIllus()}Illuflex.prototype.exists=function(a){if(typeof(a)=="undefined"){return false}else{return true}};Illuflex.prototype.recursiveMerge=function(a,f){var b={};for(var d in f){try{if(f[d].constructor==Object){b[d]=arguments.callee(a[d],f[d])}else{b[d]=(typeof(a[d])!=="undefined")?a[d]:f[d]}}catch(c){b[d]=f[d]}}return b};Illuflex.prototype.randPos=function(){var a={x:parseInt(Math.floor((Math.random()*config.cWidth)-config.negativeBufferSpace)),y:parseInt(Math.floor((Math.random()*config.cHeight)-config.negativeBufferSpace)),r:parseInt(Math.floor(Math.random()*360))};return a};Illuflex.prototype.pathConstructor=function(e,c,b){var a=this.canvas.paper.path(e).attr({fill:c.bg,"stroke-width":0});var d=this.canvas.paper.g(a);return this.groupTransform(d,c,b)};Illuflex.prototype.groupTransform=function(e,d,c,b){var f=b||false;var a="t"+d.pos.x+","+d.pos.y+" r"+d.pos.r+" s"+d.em;return e.transform(a).attr({"class":c,hasAtoms:f})};Illuflex.prototype.atomSettings=function(c,b,a,e,d){return{bg:c,em:b,pos:{x:a,y:e,r:d}}};Illuflex.prototype.getConfig=function(c){for(key in this.canvas.illuConfig){if(this.canvas.illuConfig[key].name===c){var a=this.canvas.illuConfig[key];var b=this.defaults.renderConfig.defaultObjSettings;return this.recursiveMerge(a,b)}}};Illuflex.prototype.wobble=function(){for(var g=this.canvas.elements.length-1;g>=0;g--){var c=this.canvas.elements[g],a=c.attr("class"),h=c.attr("hasAtoms"),l=this.getConfig(a);if(!l){continue}if(!this.exists(l.anim)){continue}if(l.anim===false){continue}if(h==="true"){for(var f=c.node.children.length-1;f>=0;f--){var k=c[f];if(k.attr("isAnimated")==="true"){continue}if(l.anim.reEnter){if(k.overflowReset(this.defaults.renderConfig.defaultObjSettings.anim.negativeBufferSpace)){continue}}var b=k.transform().localMatrix;var d=this.calculateAnim(l.anim,k.getBBox());var m=(d)?b.translate(d.x,d.y).rotate(d.r).scale(d.s):null;if(!d){continue}k.attr("isAnimated","true");var e=d.speed*((Math.random()*500)+200);k.animate({transform:m},e,mina.easeinout,function(){this.animCallback()})}}else{if(c.attr("isAnimated")==="true"){continue}if(l.anim.reEnter){if(c.overflowReset(this.defaults.renderConfig.defaultObjSettings.anim.negativeBufferSpace)){continue}}var b=c.transform().localMatrix;var d=this.calculateAnim(l.anim,c.getBBox());var m=(d)?b.translate(d.x,d.y).rotate(d.r).scale(d.s):null;if(!d){continue}c.attr("isAnimated","true");var e=d.speed*((Math.random()*500)+200);c.animate({transform:m},e,mina.easeinout,function(){this.animCallback()})}}};Illuflex.prototype.calculateAnim=function(g,e){var a,f,d,b;if(Math.random()<g.restlessness/2){if(g.move){if(g.tendency.x!==0){a=Math.random()*g.tendency.x*g.intensity}else{a=(Math.random()<0.5)?Math.random()*g.intensity*-1:Math.random()*g.intensity}if(g.tendency.y!==0){f=Math.random()*g.tendency.y*g.intensity}else{f=(Math.random()<0.5)?Math.random()*g.intensity*-1:Math.random()*g.intensity}}else{a=0;f=0}if(g.rotate){if(g.tendency.r!==0){d=Math.random()*g.tendency.r*g.intensity}else{d=(Math.random()<0.5)?Math.random()*g.intensity*-1:Math.random()*g.intensity}}else{d=0}if(g.pulse){b=Math.random()*(g.scaling.max-g.scaling.min)+g.scaling.min}else{b=1}return{x:a,y:f,r:d,s:b,speed:g.speed*Math.random()}}else{return false}};Illuflex.prototype.getSources=function(sources,sourceGetter){eval(sourceGetter)(this);this.sources={atomObjs:eval(sources.atomObjs),constructorObjs:eval(sources.constructorObjs)};if(config.debug){console.log("Got Sources!")}};Illuflex.prototype.drawBackground=function(){var a=(this.exists(this.canvas.renderConfig.background))?this.canvas.renderConfig.background:this.defaults.renderConfig.background;var a=(a.substr(0,1)==="#")?a:this.canvas.paper.gradient(a);if(a!==false){if(config.debug){console.log("Drawing background! ["+a+"]")}var b=this.canvas.paper.rect(0,0,config.cWidth,config.cHeight).attr({"class":"canvas-background",fill:a,"stroke-width":0})}};Illuflex.prototype.drawIllus=function(){for(var b=this.canvas.illuConfig.length-1;b>=0;b--){var a=this.canvas.illuConfig[b];if(!this.exists(a.type)){if(config.debug){console.log("ERROR! no type defined!")}return false}else{if(config.debug){console.log("Now drawing "+a.type+((a.type==="raw")?" ["+a.path+"]":""))}}var e=this.randPos();var d=(this.exists(a.pos))?a.pos:e;var d={x:(this.exists(d.x))?d.x:e.x,y:(this.exists(d.y))?d.y:e.y,r:(this.exists(d.r))?d.r:e.r};var c={pos:d,bg:(!a.bg)?this.defaults.renderConfig.defaultObjSettings.bg:(a.bg.substr(0,1)!="#")?this.canvas.paper.gradient(a.bg):a.bg,em:(!this.exists(a.em))?this.defaults.renderConfig.defaultObjSettings.em:a.em,anim:(a.anim!="undefined")?a.anim:this.defaults.renderConfig.defaultObjSettings.anim};if(a.type!="raw"){if(!this.exists(this.sources)){continue}if(!this.exists(this.sources.constructorObjs)){continue}if(!this.exists(this.sources.atomObjs)){continue}this.canvas.elements.push(this.sources.constructorObjs[a.type](c,a.name))}else{if(!this.exists(a.path)){if(config.debug){console.log("ERROR! the object type is set to raw but the path property isn't set!")}}else{if(!this.exists(a.name)){if(config.debug){console.log("ERROR! the object type is set to raw but the name property isn't set!")}}else{this.canvas.elements.push(this.pathConstructor(a.path,c,a.name))}}}}this.illusDrawnCallback()};Illuflex.prototype.illusDrawnCallback=function(){var c=this.canvas.paper.g().attr("class","illu-group");for(var b=this.canvas.elements.length-1;b>=0;b--){c.add(this.canvas.elements[b].attr("isAnimated","false"))}var a=this;if(config.debug){console.log("drawn illus!")}if(this.callback!==false){if(config.debug){console.log("callback called!")}this.callback()}if(!a.canvas.renderConfig.wobble){return}if(config.debug){console.log("… now wobbling every "+this.canvas.renderConfig.wobbleSpeed+"ms …")}setInterval(function(){if(IFScreen.isActive){a.wobble()}},a.canvas.renderConfig.wobbleSpeed)};Snap.plugin(function(d,a,b,c){a.prototype.animCallback=function(){return this.attr("isAnimated","false")};a.prototype.overflow=function(e){var f=this.getBBox();var g={right:false,bottom:false,left:false,top:false};if(f.x>(config.cWidth+e+f.w)){g.right=true}if(f.y>(config.cHeight+e+f.h)){g.bottom=true}if(f.x<-(e+f.w)){g.left=true}if(f.y2<-(e+f.h)){g.top=true}return g};a.prototype.overflowReset=function(e){var f=this.transform().localMatrix.d;var h=this.overflow(e);var g={x:"0",y:"0"};if(h.left){g.x=config.cWidth+this.getBBox().w}if(h.right){g.x=-this.getBBox().w*2}if(h.top){g.y=config.cHeight}if(h.bottom){g.y=-this.getBBox().h*2}if(g.x==0&&g.y==0){return false}else{this.transform("T"+g.x+","+g.y+" s"+f);return true}}});